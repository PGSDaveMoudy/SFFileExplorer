<template>
  <lightning-card title="Organization File Explorer" icon-name="standard:file">
    <div class="slds-grid slds-wrap">
      <!-- Filter Toggle Button -->
      <div
        class="slds-col slds-size_1-of-1 slds-p-horizontal_medium slds-p-vertical_x-small"
      >
        <lightning-button
          label={filterButtonLabel}
          onclick={toggleFilters}
          variant="neutral"
          icon-name="utility:filter"
        ></lightning-button>
      </div>

      <!-- Main Container -->
      <div class="slds-grid slds-wrap slds-gutters">
        <!-- Filter Sidebar -->
        <template if:true={showFilters}>
          <div
            class="slds-col slds-size_1-of-1 slds-medium-size_3-of-12 slds-large-size_3-of-12"
          >
            <c-file-filter-sidebar
              file-types={fileTypes}
              file-owners={fileOwners}
              onsearch={handleSearch}
              onfilterchange={handleFilterChange}
            ></c-file-filter-sidebar>
          </div>
        </template>

        <!-- Main Content Area -->
        <div class={mainContainerClass}>
          <!-- Toolbar -->
          <c-file-toolbar
            selected-count={selectedCount}
            total-count={totalCount}
            view-mode={viewMode}
            onbulkaction={handleBulkAction}
            onselectall={handleSelectAll}
            onviewmodechange={handleViewModeChange}
            onsort={handleSort}
            sort-options={sortOptions}
          ></c-file-toolbar>

          <!-- Loading Spinner -->
          <template if:true={isLoading}>
            <div class="slds-align_absolute-center slds-p-around_large">
              <lightning-spinner
                alternative-text="Loading"
                size="medium"
              ></lightning-spinner>
            </div>
          </template>

          <!-- Error Message -->
          <template if:true={error}>
            <div class="slds-p-around_medium">
              <div
                class="slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_error"
                role="alert"
              >
                <span class="slds-assistive-text">error</span>
                <h2>{error}</h2>
              </div>
            </div>
          </template>

          <!-- File List -->
          <template if:false={isLoading}>
            <template if:true={hasFiles}>
              <c-file-list
                files={files}
                view-mode={viewMode}
                selected-files={selectedFiles}
                onfileselect={handleFileSelection}
                onfilepreview={handleFilePreview}
                onfileshare={handleFileShare}
                onselectall={handleSelectAll}
                onviewconnections={handleViewConnections}
                onchangeowner={handleChangeOwner}
              ></c-file-list>

              <!-- Pagination -->
              <c-pagination-controls
                page-number={pageNumber}
                page-size={pageSize}
                total-count={totalCount}
                page-size-options={pageSizeOptions}
                onpagechange={handlePageChange}
                onpagesizechange={handlePageSizeChange}
              ></c-pagination-controls>
            </template>

            <!-- No Files Message -->
            <template if:false={hasFiles}>
              <div class="slds-align_absolute-center slds-p-around_large">
                <div class="slds-text-align_center">
                  <lightning-icon
                    icon-name="utility:file"
                    size="large"
                  ></lightning-icon>
                  <p class="slds-text-heading_medium slds-m-top_medium">
                    {noFilesMessage}
                  </p>
                </div>
              </div>
            </template>
          </template>
        </div>
      </div>
    </div>

    <!-- File Preview Modal -->
    <template if:true={showPreviewModal}>
      <c-file-preview-modal
        file-id={previewFileId}
        onclose={handleClosePreview}
      ></c-file-preview-modal>
    </template>

    <!-- File Share Modal -->
    <template if:true={showShareModal}>
      <c-file-share-modal
        file-id={shareFileId}
        file-name={shareFileName}
        onclose={handleCloseShare}
      ></c-file-share-modal>
    </template>

    <!-- Bulk Share Modal -->
    <template if:true={showBulkShareModal}>
      <c-bulk-share-modal
        selected-file-ids={selectedFiles}
        show-modal={showBulkShareModal}
        onclose={handleCloseBulkShare}
      ></c-bulk-share-modal>
    </template>

    <!-- File Connections Modal -->
    <template if:true={showConnectionsModal}>
      <c-file-connections-modal
        file-id={connectionsFileId}
        file-name={connectionsFileName}
        show-modal={showConnectionsModal}
        onclose={handleCloseConnections}
      ></c-file-connections-modal>
    </template>

    <!-- File Ownership Modal -->
    <template if:true={showOwnershipModal}>
      <c-file-ownership-modal
        file-id={ownershipFileId}
        file-name={ownershipFileName}
        current-owner-name={ownershipCurrentOwner}
        selected-file-ids={selectedFiles}
        show-modal={showOwnershipModal}
        onclose={handleCloseOwnership}
      ></c-file-ownership-modal>
    </template>
  </lightning-card>
</template>
